### 变量的存放

我们知道内存中有堆和栈。那么变量应该存放在哪？



1、基本类型  保存在栈中。因为这些类型有固定大小空间 通常按值来访问。基本类型一共是 Undefined、Null、Boolean、Number、String、Symbol。

2、引用类型 保存在堆中。因为这种值的大小不固定 不能放在栈。但是在栈里面放的是该对象的访问地址。当查询引用类型变量的时候。先从栈中读取内存地址。然后再通过地址找到堆中的值。这种叫按引用访问。



```javascript
// 1
var a = 10;
var b = a;

b = 20;
a; // ? 10


// 2
var a = {name: 'zhangsan'};
var b = a;

b.name = 'lisi'; // '李四'
a.name; // lisi

// 3
var a = {name: 'zhangsan'};
var b = a;

a = null;
b.name; // zhangsan

```



> 第一个 a b 都是基本类型。值是在栈中。 都是有自己的栈空间。修改了一个的值 不会影响另一个



> 第二个 a b 都是引用类型 栈内存中存放地址指向堆内存中的对象 引用类型会赋值新的变量自动分配一个新的值保存在变量对象中 但只是引用类型的一个地址指针而已。实际指向的是同一个对象 所以修改b.name 值之后。 相应的a.name 也就变了



> 第三个 null是基本类型 赋值null 之后 只是把a存储在栈内存中地址改成了基本类型null 并不会影响内存中的对象 b不受影响



### 内存生命周期



* 分配你要的内存
* 使用分配的内存 读 写
* 不需要的时候 释放 归还



#### 闭包中的变量

```javascript
function A() {
    let a = 1;
    function B() {
        console.log(a);
    }
    return B;
}
```

函数A弹出调用栈之后，函数A的变量a应该是**存储在堆上的** 所以函数B依旧能引用到函数A中的变量。现在的js引擎可以通过逃逸分析辨别哪些变量需要保持在堆 哪些在栈。



### 附加题

```javascript
var a = {n: 2};
var b = a;

a.x = a = {n: 1};

a.x; // ?
b.x; // ?
```



这个题目的关键在于 **优先级**

首先是 a.x的执行。 这时候就是 

```javascript
a = {
    n: 2,
    x: undefined
};
// 同时 
b = {
    n: 2, 
    x: undefined
};

// 最后就是
a = {n: 1};

b = { n: 2, x: {n : 1} };
```

赋值操作也是从右边往左边。那么就是 a = {n: 1}; a的引用就被改变了。这个返回值就赋值a.x。 就是a.x = {n : 1}; 也就是b.x = {n : 1};















